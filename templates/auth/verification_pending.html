{% extends 'base/base.html' %}
{% load static %}

{% block title %}Business Verification Pending - Autowash{% endblock %}

{% block public_content %}
<section class="auth-section min-vh-100 d-flex align-items-center">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-5 col-md-7">
                <div class="auth-card" data-aos="fade-up">
                    <div class="auth-header text-center">
                        <div class="auth-brand mb-3">
                            <span class="brand-text">AUTOWASH</span>
                        </div>
                        
                        {% if business_status == 'pending_approval' %}
                            <!-- Pending Admin Approval -->
                            <div class="mb-3">
                                <div class="bg-warning bg-opacity-10 rounded-circle d-inline-flex align-items-center justify-content-center mx-auto" style="width: 64px; height: 64px;">
                                    <i class="fas fa-clock text-warning fs-3"></i>
                                </div>
                            </div>
                            <h2 class="auth-title text-warning">Awaiting Approval</h2>
                            <p class="auth-subtitle">Your business registration is under review</p>
                            
                        {% elif business_status == 'finalizing' %}
                            <!-- Approved but finalizing setup -->
                            <div class="mb-3">
                                <div class="bg-info bg-opacity-10 rounded-circle d-inline-flex align-items-center justify-content-center mx-auto" style="width: 64px; height: 64px;">
                                    <i class="fas fa-cogs text-info fs-3"></i>
                                </div>
                            </div>
                            <h2 class="auth-title text-info">Setting Up Your Account</h2>
                            <p class="auth-subtitle">Your business has been approved and we're finalizing your setup</p>
                            
                        {% else %}
                            <!-- Default pending state -->
                            <div class="mb-3">
                                <div class="bg-primary bg-opacity-10 rounded-circle d-inline-flex align-items-center justify-content-center mx-auto" style="width: 64px; height: 64px;">
                                    <i class="fas fa-hourglass-half text-primary fs-3"></i>
                                </div>
                            </div>
                            <h2 class="auth-title">Processing Your Application</h2>
                            <p class="auth-subtitle">We're reviewing your business registration</p>
                        {% endif %}
                    </div>

                    <div class="auth-body">
                        {% if business_status == 'pending_approval' %}
                            <!-- Pending Approval Content -->
                            <div class="alert alert-warning border-0 mb-4" role="alert">
                                <div class="d-flex align-items-start">
                                    <i class="fas fa-info-circle mt-1 me-3"></i>
                                    <div>
                                        <h6 class="mb-2">What happens next?</h6>
                                        <ul class="mb-0 ps-3 small">
                                            <li>Our team will review your business registration</li>
                                            <li>You'll receive an email notification once approved</li>
                                            <li>The approval process typically takes 1-2 business days</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <!-- Business Details Summary -->
                            <div class="card border-0 bg-light mb-4">
                                <div class="card-body p-3">
                                    <h6 class="card-title mb-3">Business Registration Details</h6>
                                    <div class="small">
                                        <div class="mb-2">
                                            <strong>Business Name:</strong> {{ business.name }}
                                        </div>
                                        <div class="mb-2">
                                            <strong>Business Type:</strong> {{ business.get_business_type_display }}
                                        </div>
                                        <div class="mb-2">
                                            <strong>Email:</strong> {{ business.email }}
                                        </div>
                                        <div class="mb-2">
                                            <strong>Phone:</strong> {{ business.phone }}
                                        </div>
                                        <div class="mb-0">
                                            <strong>Subdomain:</strong> {{ business.subdomain }}.autowash.co.ke
                                        </div>
                                    </div>
                                </div>
                            </div>

                        {% elif business_status == 'finalizing' %}
                            <!-- Finalizing Setup Content -->
                            <div class="alert alert-info border-0 mb-4" role="alert">
                                <div class="d-flex align-items-start">
                                    <i class="fas fa-cogs mt-1 me-3"></i>
                                    <div>
                                        <h6 class="mb-2">Final Setup in Progress</h6>
                                        <p class="mb-2 small">Great news! Your business has been approved. We're now:</p>
                                        <ul class="mb-0 ps-3 small">
                                            <li>Creating your dedicated database</li>
                                            <li>Setting up your business environment</li>
                                            <li>Configuring your account permissions</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <!-- Progress Indicator -->
                            <div class="text-center mb-4">
                                <div class="spinner-border text-primary mb-2" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                                <p class="text-muted small">This usually takes just a few moments...</p>
                            </div>

                        {% else %}
                            <!-- Default Processing Content -->
                            <div class="alert alert-primary border-0 mb-4" role="alert">
                                <div class="d-flex align-items-start">
                                    <i class="fas fa-hourglass-half mt-1 me-3"></i>
                                    <div>
                                        <h6 class="mb-2">Application Under Review</h6>
                                        <p class="mb-0 small">We're processing your business registration. You'll be notified once the review is complete.</p>
                                    </div>
                                </div>
                            </div>
                        {% endif %}

                        <!-- Common Action Buttons -->
                        <div class="text-center mb-1">
                            <div class="d-grid gap-2">
                                <button type="button" class="btn btn-outline-primary btn-sm" onclick="window.location.reload()">
                                    <i class="fas fa-sync-alt me-1"></i>Refresh Status
                                </button>
                                <a href="{% url 'accounts:logout' %}" class="btn btn-outline-secondary btn-sm">
                                    <i class="fas fa-sign-out-alt me-1"></i>Sign Out
                                </a>
                            </div>
                        </div>

                        <!-- Contact Support -->
                        <div class="text-center">
                            <p class="text-muted small mb-1">Need help or have questions?</p>
                            <a href="mailto:support@autowash.co.ke" class="text-decoration-none small">
                                <i class="fas fa-envelope me-1"></i>Contact Support
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Auto-refresh script for finalizing status -->
{% if business_status == 'finalizing' %}
<script>
// Auto-refresh every 5 seconds when finalizing
setTimeout(function() {
    window.location.reload();
}, 5000);
</script>
{% endif %}

<!-- Status check script -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Auto-refresh every 5 minutes to check for status updates
    setInterval(function() {
        fetch(window.location.href, {
            headers: {
                'X-Requested-With': 'XMLHttpRequest'
            }
        })
        .then(response => {
            if (response.ok) {
                // If status has changed, reload the page
                window.location.reload();
            }
        })
        .catch(error => console.log('Status check failed:', error));
    }, 300000); // 5 minutes

    // Notification when page becomes visible (user switches back to tab)
    document.addEventListener('visibilitychange', function() {
        if (!document.hidden) {
            // Check for updates when user returns to tab
            setTimeout(() => window.location.reload(), 1000);
        }
    });
});
</script>
{% endblock %}