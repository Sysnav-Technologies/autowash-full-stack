<!-- templates/services/service_list.html -->
{% extends 'base/base.html' %}
{% load static %}

{% block title %}Services - {{ block.super }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/data-table.css' %}">
<link rel="stylesheet" href="{% static 'css/services.css' %}">
{% endblock %}

{% block content %}
<div class="page-header">
    <div class="page-header-content">
        <h1 class="page-title">
            <i class="fas fa-car-wash text-primary"></i>
            Service Management
        </h1>
        <p class="page-description">Manage your car wash services, pricing, and categories</p>
    </div>
    
    <div class="page-actions">
        {% if user_role in 'owner,manager' %}
        <a href="/business/{{ request.tenant.slug }}/services/create/" class="btn btn-primary">
            <i class="fas fa-plus"></i>
            Add Service
        </a>
        <div class="dropdown">
            <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                <i class="fas fa-ellipsis-h"></i>
                More Actions
            </button>
            <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="/business/{{ request.tenant.slug }}/services/categories/">
                    <i class="fas fa-tags"></i> Manage Categories
                </a></li>
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item" href="/business/{{ request.tenant.slug }}/services/export/">
                    <i class="fas fa-download"></i> Export Services
                </a></li>
                <li><a class="dropdown-item" href="/business/{{ request.tenant.slug }}/services/import/">
                    <i class="fas fa-upload"></i> Import Services
                </a></li>
            </ul>
        </div>
        {% endif %}
    </div>
</div>

<!-- Stats Cards -->
<div class="services-stats">
    <div class="services-stat-card">
        <div class="services-stat-header">
            <div class="services-stat-icon bg-primary">
                <i class="fas fa-list"></i>
            </div>
            <div class="services-stat-content">
                <h3>{{ stats.total_services }}</h3>
                <p>Total Services</p>
            </div>
        </div>
    </div>
    
    <div class="services-stat-card">
        <div class="services-stat-header">
            <div class="services-stat-icon bg-success">
                <i class="fas fa-tags"></i>
            </div>
            <div class="services-stat-content">
                <h3>{{ stats.total_categories }}</h3>
                <p>Categories</p>
            </div>
        </div>
    </div>
    
    <div class="services-stat-card">
        <div class="services-stat-header">
            <div class="services-stat-icon bg-warning">
                <i class="fas fa-star"></i>
            </div>
            <div class="services-stat-content">
                <h3>{{ stats.popular_services }}</h3>
                <p>Popular Services</p>
            </div>
        </div>
    </div>
    
    <div class="services-stat-card">
        <div class="services-stat-header">
            <div class="services-stat-icon bg-info">
                <i class="fas fa-dollar-sign"></i>
            </div>
            <div class="services-stat-content">
                <h3>KES {{ stats.avg_price|floatformat:0 }}</h3>
                <p>Average Price</p>
            </div>
        </div>
    </div>
</div>

<!-- Filters -->
<div class="content-card">
    <div class="card-header">
        <h5 class="card-title">Filter Services</h5>
    </div>
    <div class="card-body">
        <form method="GET" class="filter-form">
            <div class="row">
                <div class="col-md-3">
                    <label for="category">Category</label>
                    <select name="category" id="category" class="form-select">
                        <option value="">All Categories</option>
                        {% for category in categories %}
                        <option value="{{ category.id }}" {% if current_filters.category == category.id|stringformat:"s" %}selected{% endif %}>
                            {{ category.name }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="col-md-3">
                    <label for="search">Search</label>
                    <input type="text" name="search" id="search" class="form-control" 
                           placeholder="Search services..." value="{{ current_filters.search }}">
                </div>
                
                <div class="col-md-3">
                    <label for="status">Status</label>
                    <select name="status" id="status" class="form-select">
                        <option value="">All Status</option>
                        <option value="active" {% if current_filters.status == 'active' %}selected{% endif %}>Active</option>
                        <option value="inactive" {% if current_filters.status == 'inactive' %}selected{% endif %}>Inactive</option>
                    </select>
                </div>
                
                <div class="col-md-3">
                    <label>&nbsp;</label>
                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-primary flex-fill">
                            <i class="fas fa-search"></i>
                            Search
                        </button>
                        <a href="/business/{{ request.tenant.slug }}/services/" class="btn btn-outline-secondary">
                            <i class="fas fa-times"></i>
                            Clear
                        </a>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- Services Table -->
<div class="data-table-container">
    <div class="data-table-header">
        <h5 class="data-table-title">
            Services
            <span class="table-badge table-badge-secondary">{{ services.paginator.count }}</span>
        </h5>
    </div>
    
    <div class="data-table-scroll">
        {% if services %}
        <table class="data-table" data-sortable="true">
            <thead>
                <tr>
                    <th class="sortable" data-column="name">Service</th>
                    <th class="sortable" data-column="category">Category</th>
                    <th class="sortable" data-column="price">Price</th>
                    <th class="sortable" data-column="duration">Duration</th>
                    <th>Popularity</th>
                    <th class="sortable" data-column="status">Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for service in services %}
                <tr data-id="{{ service.id }}">
                    <td>
                        <div class="table-cell-main">
                            {% if service.image %}
                            <img src="{{ service.image.url }}" alt="{{ service.name }}" 
                                 class="table-cell-avatar" width="40" height="40">
                            {% else %}
                            <div class="table-cell-avatar">
                                <i class="fas fa-car-wash"></i>
                            </div>
                            {% endif %}
                            
                            <div class="table-cell-content">
                                <div class="table-cell-title">{{ service.name }}</div>
                                <div class="table-cell-subtitle">{{ service.description|truncatewords:8 }}</div>
                                {% if service.is_popular or service.is_premium %}
                                <div class="table-cell-badges">
                                    {% if service.is_popular %}
                                    <span class="table-badge table-badge-warning">Popular</span>
                                    {% endif %}
                                    {% if service.is_premium %}
                                    <span class="table-badge table-badge-info">Premium</span>
                                    {% endif %}
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </td>
                    <td>
                        <span class="table-badge table-badge-secondary">
                            {{ service.category.name|default:"Uncategorized" }}
                        </span>
                    </td>
                    <td>
                        <div>
                            <div class="table-cell-title">KES {{ service.base_price }}</div>
                            {% if service.min_price and service.max_price %}
                            <div class="table-cell-subtitle">Range: {{ service.min_price }} - {{ service.max_price }}</div>
                            {% endif %}
                        </div>
                    </td>
                    <td>
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <i class="fas fa-clock" style="color: var(--gray-400); font-size: 0.75rem;"></i>
                            <span>{{ service.estimated_duration }} min</span>
                        </div>
                    </td>
                    <td>
                        <div>
                            <div class="table-cell-title">{{ service.orders_count|default:0 }} orders</div>
                            <div class="table-cell-subtitle">This month</div>
                        </div>
                    </td>
                    <td>
                        {% if service.is_active %}
                        <span class="table-badge table-status-active">
                            <i class="fas fa-check-circle" style="margin-right: 0.25rem;"></i>
                            Active
                        </span>
                        {% else %}
                        <span class="table-badge table-status-inactive">
                            <i class="fas fa-pause-circle" style="margin-right: 0.25rem;"></i>
                            Inactive
                        </span>
                        {% endif %}
                    </td>
                    <td>
                        <div class="table-actions">
                            <a href="/business/{{ request.tenant.slug }}/services/{{ service.pk }}/" 
                               class="table-action-btn table-action-view" title="View Details">
                                <i class="fas fa-eye"></i>
                            </a>
                            {% if user_role in 'owner,manager' %}
                            <a href="/business/{{ request.tenant.slug }}/services/{{ service.pk }}/edit/" 
                               class="table-action-btn table-action-edit" title="Edit Service">
                                <i class="fas fa-edit"></i>
                            </a>
                            <button type="button" class="table-action-btn table-action-delete" 
                                    title="Delete Service" onclick="deleteService('{{ service.pk }}')">
                                <i class="fas fa-trash"></i>
                            </button>
                            {% endif %}
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <div class="data-table-empty">
            <div class="data-table-empty-icon">
                <i class="fas fa-car-wash"></i>
            </div>
            <h5 class="data-table-empty-title">No Services Found</h5>
            <p class="data-table-empty-description">
                {% if request.GET.search or request.GET.category or request.GET.status %}
                    No services match your current filters. Try adjusting your search criteria.
                {% else %}
                    You haven't added any services yet.
                {% endif %}
            </p>
            {% if user_role in 'owner,manager' and not request.GET.search and not request.GET.category and not request.GET.status %}
            <a href="/business/{{ request.tenant.slug }}/services/add/" class="btn btn-primary">
                <i class="fas fa-plus me-1"></i>
                Add Your First Service
            </a>
            {% endif %}
        </div>
        {% endif %}
    </div>
    
    {% if services.has_other_pages %}
    <div class="data-table-pagination">
        <div class="data-table-pagination-info">
            Showing {{ services.start_index }}-{{ services.end_index }} of {{ services.paginator.count }} services
        </div>
        
        <div class="data-table-pagination-nav">
            {% if services.has_previous %}
            <a class="data-table-pagination-btn" href="?page={{ services.previous_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}" aria-label="Previous page">
                <i class="fas fa-chevron-left"></i>
            </a>
            {% endif %}
            
            {% for num in services.paginator.page_range %}
                {% if num == services.number %}
                <span class="data-table-pagination-btn active">{{ num }}</span>
                {% elif num > services.number|add:'-3' and num < services.number|add:'3' %}
                <a class="data-table-pagination-btn" href="?page={{ num }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}">{{ num }}</a>
                {% endif %}
            {% endfor %}
            
            {% if services.has_next %}
            <a class="data-table-pagination-btn" href="?page={{ services.next_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}" aria-label="Next page">
                <i class="fas fa-chevron-right"></i>
            </a>
            {% endif %}
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/services.js' %}"></script>
{% endblock %}
