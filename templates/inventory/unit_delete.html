{% extends 'base/base.html' %}
{% load static %}

{% block title %}Delete Unit - {{ request.tenant.name }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/inventory.css' %}">
{% endblock %}

{% block content %}
<div class="page-header">
    <div class="page-header-content">
        <div class="page-breadcrumb">
            <a href="/business/{{ request.tenant.slug }}/inventory/" class="breadcrumb-link">Inventory</a>
            <i class="fas fa-chevron-right"></i>
            <a href="/business/{{ request.tenant.slug }}/inventory/units/" class="breadcrumb-link">Units</a>
            <i class="fas fa-chevron-right"></i>
            <a href="/business/{{ request.tenant.slug }}/inventory/units/{{ unit.id }}/" class="breadcrumb-link">{{ unit.name }}</a>
            <i class="fas fa-chevron-right"></i>
            <span class="breadcrumb-current">Delete</span>
        </div>
        <h1 class="page-title text-danger">
            <i class="fas fa-trash"></i>
            Delete Unit
        </h1>
    </div>
</div>

<div class="row justify-content-center">
    <div class="col-lg-6">
        <div class="card border-danger">
            <div class="card-header bg-danger text-white">
                <h5 class="mb-0">
                    <i class="fas fa-exclamation-triangle"></i>
                    Confirm Deletion
                </h5>
            </div>
            <div class="card-body">
                <div class="alert alert-danger">
                    <i class="fas fa-warning"></i>
                    <strong>Warning!</strong> This action cannot be undone.
                </div>

                <h6>You are about to delete the following unit:</h6>
                
                <div class="unit-details bg-light p-3 rounded mb-4">
                    <div class="row">
                        <div class="col-sm-4 fw-semibold">Name:</div>
                        <div class="col-sm-8">{{ unit.name }}</div>
                    </div>
                    <div class="row">
                        <div class="col-sm-4 fw-semibold">Symbol:</div>
                        <div class="col-sm-8"><code>{{ unit.symbol }}</code></div>
                    </div>
                    <div class="row">
                        <div class="col-sm-4 fw-semibold">Type:</div>
                        <div class="col-sm-8">{{ unit.get_unit_type_display }}</div>
                    </div>
                    <div class="row">
                        <div class="col-sm-4 fw-semibold">Status:</div>
                        <div class="col-sm-8">
                            {% if unit.is_active %}
                                <span class="badge bg-success">Active</span>
                            {% else %}
                                <span class="badge bg-secondary">Inactive</span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-4 fw-semibold">Created:</div>
                        <div class="col-sm-8">{{ unit.created_at|date:"M d, Y" }}</div>
                    </div>
                </div>

                <!-- Impact Analysis -->
                <div class="impact-analysis mb-4">
                    <h6 class="text-warning">
                        <i class="fas fa-info-circle"></i>
                        Impact Analysis
                    </h6>
                    
                    {% if items_using_unit_count > 0 %}
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle"></i>
                            <strong>{{ items_using_unit_count }}</strong> inventory item{{ items_using_unit_count|pluralize }} 
                            {{ items_using_unit_count|pluralize:"is,are" }} currently using this unit.
                        </div>
                        
                        <div class="mb-3">
                            <h6>Items that will be affected:</h6>
                            <div class="items-list bg-light p-3 rounded" style="max-height: 200px; overflow-y: auto;">
                                {% for item in items_using_unit %}
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <div>
                                            <strong>{{ item.name }}</strong>
                                            <br><small class="text-muted">{{ item.sku }}</small>
                                        </div>
                                        <span class="badge bg-secondary">{{ item.current_stock }} {{ unit.symbol }}</span>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                        
                        <div class="alert alert-info">
                            <i class="fas fa-lightbulb"></i>
                            <strong>Note:</strong> Before deleting this unit, you should either:
                            <ul class="mb-0 mt-2">
                                <li>Update affected items to use a different unit</li>
                                <li>Delete the affected items first</li>
                                <li>Deactivate this unit instead of deleting it</li>
                            </ul>
                        </div>
                    {% else %}
                        <div class="alert alert-success">
                            <i class="fas fa-check-circle"></i>
                            No inventory items are currently using this unit. It's safe to delete.
                        </div>
                    {% endif %}
                </div>

                <!-- Deletion Options -->
                {% if items_using_unit_count > 0 %}
                    <div class="alert alert-danger">
                        <i class="fas fa-ban"></i>
                        <strong>Cannot Delete:</strong> This unit is currently in use. Please reassign or delete the affected items first.
                    </div>
                    
                    <div class="d-flex gap-2">
                        <a href="/business/{{ request.tenant.slug }}/inventory/units/{{ unit.id }}/" class="btn btn-secondary">
                            <i class="fas fa-arrow-left"></i>
                            Go Back
                        </a>
                        <a href="/business/{{ request.tenant.slug }}/inventory/units/{{ unit.id }}/edit/" class="btn btn-warning">
                            <i class="fas fa-edit"></i>
                            Edit Unit Instead
                        </a>
                        <form method="post" action="/business/{{ request.tenant.slug }}/inventory/units/{{ unit.id }}/toggle/" class="d-inline">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-info">
                                <i class="fas fa-pause"></i>
                                Deactivate Instead
                            </button>
                        </form>
                    </div>
                {% else %}
                    <form method="post">
                        {% csrf_token %}
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="confirm_delete" required>
                            <label class="form-check-label" for="confirm_delete">
                                I understand that this action cannot be undone and I want to permanently delete this unit.
                            </label>
                        </div>
                        
                        <div class="d-flex gap-2">
                            <button type="submit" class="btn btn-danger">
                                <i class="fas fa-trash"></i>
                                Yes, Delete Unit
                            </button>
                            <a href="/business/{{ request.tenant.slug }}/inventory/units/{{ unit.id }}/" class="btn btn-secondary">
                                <i class="fas fa-times"></i>
                                Cancel
                            </a>
                        </div>
                    </form>
                {% endif %}
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<style>
.items-list {
    border: 1px solid #dee2e6;
}

.unit-details .row {
    margin-bottom: 0.5rem;
}

.impact-analysis {
    border-left: 4px solid #ffc107;
    padding-left: 1rem;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('form[method="post"]');
    const deleteButton = document.querySelector('button[type="submit"]');
    
    if (form && deleteButton) {
        form.addEventListener('submit', function(e) {
            if (!confirm('Are you absolutely sure you want to delete this unit? This action cannot be undone.')) {
                e.preventDefault();
            }
        });
    }
});
</script>
{% endblock %}
