<!-- includes/sidebar/modules/services.html -->
<li class="nav-item nav-dropdown" id="services-dropdown">
    <a class="nav-link nav-dropdown-toggle {% if 'services' in request.resolver_match.namespace %}active{% endif %}" 
       href="#" onclick="toggleDropdown('services-dropdown')">
        <i class="nav-icon fas fa-car-wash"></i>
        <span class="nav-text">Services</span>
    </a>
    <ul class="nav-submenu">
        <!-- Attendant Specific Dashboard -->
        {% if user_role == 'attendant' %}
        <li class="nav-item">
            <a class="nav-link nav-link-featured {% if request.resolver_match.url_name == 'attendant_dashboard' %}active{% endif %}" 
               href="/business/{{ request.tenant.slug }}/services/dashboard/">
                <i class="nav-icon fas fa-user-cog"></i>
                <span class="nav-text">My Dashboard</span>
            </a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link {% if request.resolver_match.url_name == 'my_services' %}active{% endif %}" 
               href="/business/{{ request.tenant.slug }}/services/my-services/">
                <i class="nav-icon fas fa-clipboard-user"></i>
                <span class="nav-text">My Services</span>
                {% if my_active_services_count > 0 %}
                <span class="nav-badge nav-badge-primary">{{ my_active_services_count }}</span>
                {% endif %}
            </a>
        </li>
        {% endif %}

        <!-- Service Management - Manager/Owner/Supervisor -->
        {% if user_role in 'owner,manager,supervisor' %}
        <li class="nav-item">
            <a class="nav-link {% if request.resolver_match.url_name == 'list' and 'services' in request.resolver_match.namespace %}active{% endif %}" 
               href="/business/{{ request.tenant.slug }}/services/">
                <i class="nav-icon fas fa-list"></i>
                <span class="nav-text">All Services</span>
            </a>
        </li>
        
        {% if user_role in 'owner,manager' %}
        <li class="nav-item">
            <a class="nav-link {% if request.resolver_match.url_name == 'create' and 'services' in request.resolver_match.namespace %}active{% endif %}" 
               href="/business/{{ request.tenant.slug }}/services/create/">
                <i class="nav-icon fas fa-plus-circle"></i>
                <span class="nav-text">Add Service</span>
            </a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link {% if request.resolver_match.url_name == 'category_list' %}active{% endif %}" 
               href="/business/{{ request.tenant.slug }}/services/categories/">
                <i class="nav-icon fas fa-tags"></i>
                <span class="nav-text">Categories</span>
            </a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link {% if request.resolver_match.url_name == 'package_list' %}active{% endif %}" 
               href="/business/{{ request.tenant.slug }}/services/packages/">
                <i class="nav-icon fas fa-box-open"></i>
                <span class="nav-text">Service Packages</span>
            </a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link {% if request.resolver_match.url_name == 'bay_list' %}active{% endif %}" 
               href="/business/{{ request.tenant.slug }}/services/bays/">
                <i class="nav-icon fas fa-car"></i>
                <span class="nav-text">Service Bays</span>
            </a>
        </li>
        {% endif %}
        {% endif %}
        
        <!-- Orders & Queue Section -->
        <li class="nav-divider">
            <span class="nav-divider-text">Orders & Queue</span>
        </li>
        
        <li class="nav-item">
            <a class="nav-link {% if request.resolver_match.url_name == 'order_list' %}active{% endif %}" 
               href="/business/{{ request.tenant.slug }}/services/orders/">
                <i class="nav-icon fas fa-clipboard-list"></i>
                <span class="nav-text">Service Orders</span>
                {% if pending_orders_count > 0 %}
                <span class="nav-badge nav-badge-warning">{{ pending_orders_count }}</span>
                {% endif %}
            </a>
        </li>
        
        {% if user_role in 'owner,manager,supervisor' %}
        <li class="nav-item">
            <a class="nav-link {% if request.resolver_match.url_name == 'create_order' %}active{% endif %}" 
               href="/business/{{ request.tenant.slug }}/services/orders/create/">
                <i class="nav-icon fas fa-plus"></i>
                <span class="nav-text">Create Order</span>
            </a>
        </li>
        {% endif %}
        
        <li class="nav-item">
            <a class="nav-link nav-link-featured {% if request.resolver_match.url_name == 'quick_order' %}active{% endif %}" 
               href="/business/{{ request.tenant.slug }}/services/orders/quick/">
                <i class="nav-icon fas fa-bolt"></i>
                <span class="nav-text">Quick Order</span>
                <span class="nav-badge nav-badge-primary">FAST</span>
            </a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link {% if request.resolver_match.url_name == 'queue' %}active{% endif %}" 
               href="/business/{{ request.tenant.slug }}/services/queue/">
                <i class="nav-icon fas fa-tasks"></i>
                <span class="nav-text">Service Queue</span>
                {% if active_queue_count > 0 %}
                <span class="nav-badge nav-badge-success">{{ active_queue_count }}</span>
                {% endif %}
            </a>
        </li>
        
        <!-- Quick Actions for Attendants -->
        {% if user_role == 'attendant' %}
        <li class="nav-divider">
            <span class="nav-divider-text">Quick Actions</span>
        </li>
        
        <li class="nav-item">
            <a class="nav-link nav-link-action {% if request.resolver_match.url_name == 'quick_customer_register' %}active{% endif %}" 
               href="/business/{{ request.tenant.slug }}/services/quick/customer-register/">
                <i class="nav-icon fas fa-user-plus"></i>
                <span class="nav-text">Register Customer</span>
            </a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link nav-link-action {% if request.resolver_match.url_name == 'quick_service_assign' %}active{% endif %}" 
               href="/business/{{ request.tenant.slug }}/services/quick/service-assign/">
                <i class="nav-icon fas fa-hand-point-right"></i>
                <span class="nav-text">Assign Service</span>
            </a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link nav-link-action" href="#" onclick="startNextService()">
                <i class="nav-icon fas fa-play-circle"></i>
                <span class="nav-text">Start Next Service</span>
            </a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link nav-link-action" href="#" onclick="completeCurrentService()">
                <i class="nav-icon fas fa-check-circle"></i>
                <span class="nav-text">Complete Service</span>
            </a>
        </li>
        {% endif %}
        
        <!-- Reports & Analytics (Manager/Owner) -->
        {% if user_role in 'owner,manager' %}
        <li class="nav-divider">
            <span class="nav-divider-text">Reports & Analytics</span>
        </li>
        
        <li class="nav-item">
            <a class="nav-link {% if request.resolver_match.url_name == 'reports' %}active{% endif %}" 
               href="/business/{{ request.tenant.slug }}/services/reports/">
                <i class="nav-icon fas fa-chart-line"></i>
                <span class="nav-text">Service Reports</span>
            </a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link {% if request.resolver_match.url_name == 'daily_report' %}active{% endif %}" 
               href="/business/{{ request.tenant.slug }}/services/reports/daily/">
                <i class="nav-icon fas fa-calendar-day"></i>
                <span class="nav-text">Daily Report</span>
            </a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link {% if request.resolver_match.url_name == 'performance_report' %}active{% endif %}" 
               href="/business/{{ request.tenant.slug }}/services/reports/performance/">
                <i class="nav-icon fas fa-chart-bar"></i>
                <span class="nav-text">Performance Report</span>
            </a>
        </li>
        
        <li class="nav-item">
            <a class="nav-link {% if request.resolver_match.url_name == 'export' %}active{% endif %}" 
               href="/business/{{ request.tenant.slug }}/services/export/">
                <i class="nav-icon fas fa-download"></i>
                <span class="nav-text">Export Data</span>
            </a>
        </li>
        {% endif %}
    </ul>
</li>

<style>
/* Enhanced Services Module Styles */
.nav-dropdown {
    position: relative;
}

.nav-dropdown-toggle {
    position: relative;
    justify-content: space-between;
}

.nav-arrow {
    margin-left: auto;
    transition: transform var(--transition-fast);
    font-size: 0.75rem;
    color: var(--gray-400);
}

.nav-dropdown.open .nav-arrow {
    transform: rotate(90deg);
}

.nav-submenu {
    list-style: none;
    padding: 0;
    margin: 0;
    padding-left: 0;
    max-height: 0;
    overflow: hidden;
    transition: max-height var(--transition-normal), padding var(--transition-normal);
    background: rgba(0, 0, 0, 0.02);
    border-radius: 0 0 var(--radius-md) var(--radius-md);
    margin: 0 0.75rem;
}

.nav-dropdown.open .nav-submenu {
    max-height: 800px;
    padding: 0.5rem 0;
}

.sidebar.collapsed .nav-submenu {
    display: none;
}

.nav-submenu .nav-link {
    padding: 0.625rem 1.25rem;
    font-size: 0.875rem;
    color: var(--gray-600);
    margin: 0.125rem 0.5rem;
    border-radius: var(--radius-sm);
    position: relative;
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.nav-submenu .nav-link:hover {
    color: var(--gray-900);
    background-color: var(--gray-100);
    transform: translateX(4px);
}

.nav-submenu .nav-link.active {
    color: var(--primary-700);
    background-color: var(--primary-50);
    font-weight: 600;
}

.nav-submenu .nav-link.active::before {
    content: '';
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    width: 2px;
    height: 1rem;
    background-color: var(--primary-600);
    border-radius: 1px;
}

/* Enhanced Icon Styling */
.nav-submenu .nav-icon {
    width: 16px;
    height: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.875rem;
    flex-shrink: 0;
}

/* Navigation Badges */
.nav-badge {
    font-size: 0.625rem;
    font-weight: 700;
    padding: 0.125rem 0.375rem;
    border-radius: 50px;
    margin-left: auto;
    line-height: 1;
    text-transform: uppercase;
    letter-spacing: 0.025em;
}

.nav-badge-primary {
    background: var(--primary-100);
    color: var(--primary-700);
}

.nav-badge-success {
    background: var(--success-100);
    color: var(--success-700);
}

.nav-badge-warning {
    background: var(--warning-100);
    color: var(--warning-700);
}

.nav-badge-secondary {
    background: var(--gray-200);
    color: var(--gray-600);
}

.nav-badge-info {
    margin-left: auto;
    opacity: 0;
    transition: opacity var(--transition-fast);
}

.nav-link:hover .nav-badge-info {
    opacity: 1;
}

.nav-badge-info i {
    font-size: 0.75rem;
    color: var(--gray-400);
    cursor: help;
}

/* Section Dividers */
.nav-divider {
    margin: 0.75rem 0 0.5rem;
    padding: 0 1.25rem;
}

.nav-divider-text {
    font-size: 0.625rem;
    font-weight: 700;
    color: var(--gray-400);
    text-transform: uppercase;
    letter-spacing: 0.1em;
    position: relative;
    padding-left: 0.75rem;
}

.nav-divider-text::before {
    content: '';
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    width: 2px;
    height: 0.75rem;
    background: linear-gradient(to bottom, var(--primary-500), transparent);
    border-radius: 1px;
}

/* Featured Link Styling */
.nav-link-featured {
    background: linear-gradient(135deg, var(--primary-50), var(--info-50));
    border: 1px solid var(--primary-200);
    position: relative;
    overflow: hidden;
}

.nav-link-featured::after {
    content: '';
    position: absolute;
    top: -50%;
    right: -50%;
    width: 20px;
    height: 20px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 50%;
    animation: shimmer 3s infinite;
}

@keyframes shimmer {
    0%, 100% { transform: translateX(-100px) translateY(-100px); opacity: 0; }
    50% { transform: translateX(0) translateY(0); opacity: 1; }
}

.nav-link-featured:hover {
    background: linear-gradient(135deg, var(--primary-100), var(--info-100));
    transform: translateX(4px) translateY(-1px);
    box-shadow: var(--shadow-sm);
}

/* Action Link Styling */
.nav-link-action {
    background: var(--success-50);
    border: 1px solid var(--success-200);
    color: var(--success-700);
}

.nav-link-action:hover {
    background: var(--success-100);
    color: var(--success-800);
    transform: translateX(4px);
}

/* Coming Soon Items */
.nav-item-coming-soon .nav-link {
    opacity: 0.6;
    cursor: not-allowed;
}

.nav-item-coming-soon .nav-link:hover {
    transform: none;
    background: var(--gray-50);
}

/* Collapsed Sidebar Adjustments */
.sidebar.collapsed .nav-badge {
    position: absolute;
    top: 0.25rem;
    right: 0.25rem;
    margin-left: 0;
    transform: scale(0.8);
}

.sidebar.collapsed .nav-arrow {
    display: none;
}

.sidebar.collapsed .nav-badge-info {
    display: none;
}

/* Mobile Responsive */
@media (max-width: 768px) {
    .nav-submenu {
        margin: 0;
        background: var(--gray-50);
    }
    
    .nav-submenu .nav-link {
        padding: 0.75rem 1rem;
        margin: 0.125rem 0;
    }
    
    .nav-badge {
        font-size: 0.625rem;
        padding: 0.125rem 0.25rem;
    }
}

/* Accessibility Improvements */
.nav-link:focus {
    outline: 2px solid var(--primary-500);
    outline-offset: 2px;
}

.nav-dropdown-toggle[aria-expanded="true"] .nav-arrow {
    transform: rotate(90deg);
}

/* Loading States */
.nav-link.loading {
    opacity: 0.6;
    pointer-events: none;
}

.nav-link.loading .nav-icon::after {
    content: '';
    position: absolute;
    width: 12px;
    height: 12px;
    border: 1px solid var(--primary-200);
    border-top: 1px solid var(--primary-600);
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}
</style>

<script>
// Services Module JavaScript Functions
function showComingSoon(featureName) {
    // Create and show a toast notification
    const toast = document.createElement('div');
    toast.className = 'toast-notification coming-soon-toast';
    toast.innerHTML = `
        <div class="toast-content">
            <i class="fas fa-rocket text-primary"></i>
            <div>
                <div class="toast-title">Coming Soon!</div>
                <div class="toast-message">${featureName} feature is in development</div>
            </div>
        </div>
        <button class="toast-close" onclick="this.parentElement.remove()">
            <i class="fas fa-times"></i>
        </button>
    `;
    
    document.body.appendChild(toast);
    
    // Auto-remove after 3 seconds
    setTimeout(() => {
        if (toast.parentElement) {
            toast.remove();
        }
    }, 3000);
}

// Quick action functions for attendants
function startService() {
    // This would integrate with your service queue system
    $.ajax({
        url: '/business/{{ request.tenant.slug }}/services/ajax/start-next/',
        method: 'POST',
        success: function(data) {
            if (data.success) {
                showSuccessToast('Service started successfully');
                // Optionally redirect to service detail
                if (data.redirect_url) {
                    window.location.href = data.redirect_url;
                }
            } else {
                showErrorToast(data.message || 'No services in queue');
            }
        },
        error: function() {
            showErrorToast('Error starting service');
        }
    });
}

function completeService() {
    // This would show a modal or redirect to complete current service
    $.ajax({
        url: '/business/{{ request.tenant.slug }}/services/ajax/current-service/',
        method: 'GET',
        success: function(data) {
            if (data.current_service) {
                // Redirect to complete service page
                window.location.href = `/business/{{ request.tenant.slug }}/services/orders/${data.current_service.id}/complete/`;
            } else {
                showInfoToast('No active service to complete');
            }
        },
        error: function() {
            showErrorToast('Error checking current service');
        }
    });
}

// Toast notification functions
function showSuccessToast(message) {
    showToast(message, 'success', 'check-circle');
}

function showErrorToast(message) {
    showToast(message, 'danger', 'exclamation-triangle');
}

function showInfoToast(message) {
    showToast(message, 'info', 'info-circle');
}

function showToast(message, type, icon) {
    const toast = document.createElement('div');
    toast.className = `toast-notification toast-${type}`;
    toast.innerHTML = `
        <div class="toast-content">
            <i class="fas fa-${icon} text-${type}"></i>
            <div>
                <div class="toast-message">${message}</div>
            </div>
        </div>
        <button class="toast-close" onclick="this.parentElement.remove()">
            <i class="fas fa-times"></i>
        </button>
    `;
    
    document.body.appendChild(toast);
    
    setTimeout(() => {
        if (toast.parentElement) {
            toast.remove();
        }
    }, 4000);
}

// Initialize tooltips for this module
$(document).ready(function() {
    $('[data-bs-toggle="tooltip"]').tooltip();
});
</script>

<!-- Toast Notification Styles -->
<style>
.toast-notification {
    position: fixed;
    top: 2rem;
    right: 2rem;
    background: white;
    border: 1px solid var(--gray-200);
    border-radius: var(--radius-lg);
    padding: 1rem;
    box-shadow: var(--shadow-lg);
    z-index: 9999;
    min-width: 300px;
    animation: slideInRight 0.3s ease-out;
}

.toast-notification.coming-soon-toast {
    border-left: 4px solid var(--primary-500);
}

.toast-notification.toast-success {
    border-left: 4px solid var(--success-500);
}

.toast-notification.toast-danger {
    border-left: 4px solid var(--danger-500);
}

.toast-notification.toast-info {
    border-left: 4px solid var(--info-500);
}

.toast-content {
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
}

.toast-title {
    font-weight: 600;
    color: var(--gray-900);
    margin-bottom: 0.25rem;
}

.toast-message {
    color: var(--gray-700);
    font-size: 0.875rem;
}

.toast-close {
    position: absolute;
    top: 0.5rem;
    right: 0.5rem;
    background: none;
    border: none;
    color: var(--gray-400);
    cursor: pointer;
    padding: 0.25rem;
    border-radius: var(--radius-sm);
    transition: all var(--transition-fast);
}

.toast-close:hover {
    background: var(--gray-100);
    color: var(--gray-600);
}

@keyframes slideInRight {
    from {
        opacity: 0;
        transform: translateX(100%);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

@media (max-width: 768px) {
    .toast-notification {
        top: 1rem;
        right: 1rem;
        left: 1rem;
        min-width: auto;
    }
}
</style>