{% extends 'base/base.html' %}
{% load static %}

{% block title %}Choose Your Plan - {{ block.super }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/subscriptions.css' %}">
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/subscriptions.js' %}"></script>
{% endblock %}

{% block public_content %}
<div class="subscription-page">
    <div class="container">
        <!-- Step Indicator -->
        <div class="step-indicator">
            <div class="step completed">
                <div class="step-number">1</div>
                <span>Registration</span>
            </div>
            <div class="step-divider"></div>
            <div class="step active">
                <div class="step-number">2</div>
                <span>Choose Plan</span>
            </div>
            <div class="step-divider"></div>
            <div class="step">
                <div class="step-number">3</div>
                <span>Verification</span>
            </div>
        </div>
        
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-title">Offering Competitive Prices for you</h1>
            <p class="page-subtitle">Welcome {{ business.name }}! Choose the plan that best fits your business needs.</p>
            
            <!-- Billing Toggle -->
            <div class="billing-toggle">
                <button class="billing-option active" id="monthly-tab">Monthly Billing</button>
                <button class="billing-option" id="annual-tab">Annual Billing <small class="ms-1">(Save 15%)</small></button>
            </div>
        </div>
        
        <!-- Plans Grid -->
        <div class="plans-container">
            <div class="row g-4">
                {% for plan in plans %}
                <div class="col-lg-4 col-md-6">
                    <div class="plan-card {% if plan.is_popular %}featured{% endif %}">
                        <!-- Plan Header -->
                        <div class="plan-header">
                            {% if plan.name == 'Monthly Plan' or plan.duration_months == 1 %}
                                <h3 class="plan-name">Monthly Plan</h3>
                                <p class="plan-description">Ideal for startups and small businesses looking get started essential IT services.</p>
                            {% elif plan.name == 'Semi-Annual Plan' or plan.duration_months == 6 %}
                                <h3 class="plan-name">Semi-Annual Plan</h3>
                                <p class="plan-description">Perfect for growing businesses that require additional features and support.</p>
                            {% elif plan.name == 'Annual Plan' or plan.duration_months == 12 %}
                                <h3 class="plan-name">Annual Plan</h3>
                                <p class="plan-description">Tailored for larger enterprises with complex IT needs and stringent security.</p>
                            {% else %}
                                <h3 class="plan-name">{{ plan.name }}</h3>
                                <p class="plan-description">{{ plan.description|truncatewords:10 }}</p>
                            {% endif %}
                        </div>
                        
                        <!-- Pricing -->
                        <div class="plan-pricing">
                            <div class="price-display">
                                <span class="currency">KES</span>
                                <span class="amount">{{ plan.price|floatformat:0 }}</span>
                                <span class="period">
                                    {% if plan.duration_months == 1 %}
                                        /month
                                    {% elif plan.duration_months == 6 %}
                                        /6 months
                                    {% elif plan.duration_months == 12 %}
                                        /Year
                                    {% else %}
                                        /{{ plan.duration_months }}mo
                                    {% endif %}
                                </span>
                            </div>
                            <div class="billing-note">7-day free trial included</div>
                        </div>
                        
                        <!-- Features -->
                        <div class="features-section">
                            <h4 class="features-title">Featured Included:</h4>
                            <ul class="features-list">
                                {% if plan.duration_months == 1 %}
                                    <!-- Monthly Plan Features -->
                                    <li class="feature-item">
                                        <i class="fas fa-check feature-icon"></i>
                                        <span>Network Monitoring</span>
                                    </li>
                                    <li class="feature-item">
                                        <i class="fas fa-check feature-icon"></i>
                                        <span>Helpdesk Support (Limited Hours)</span>
                                    </li>
                                    <li class="feature-item">
                                        <i class="fas fa-check feature-icon"></i>
                                        <span>Basic Cybersecurity Protection</span>
                                    </li>
                                {% elif plan.duration_months == 6 %}
                                    <!-- Semi-Annual Plan Features -->
                                    <li class="feature-item">
                                        <i class="fas fa-check feature-icon"></i>
                                        <span>24/7 Network Monitoring</span>
                                    </li>
                                    <li class="feature-item">
                                        <i class="fas fa-check feature-icon"></i>
                                        <span>Dedicated Helpdesk Support</span>
                                    </li>
                                    <li class="feature-item">
                                        <i class="fas fa-check feature-icon"></i>
                                        <span>Advance Cybersecurity Protection</span>
                                    </li>
                                    <li class="feature-item">
                                        <i class="fas fa-check feature-icon"></i>
                                        <span>Cloud Backup & Recovery</span>
                                    </li>
                                {% elif plan.duration_months == 12 %}
                                    <!-- Annual Plan Features -->
                                    <li class="feature-item">
                                        <i class="fas fa-check feature-icon"></i>
                                        <span>Customised Network Monitoring</span>
                                    </li>
                                    <li class="feature-item">
                                        <i class="fas fa-check feature-icon"></i>
                                        <span>Priority Helpdesk Support</span>
                                    </li>
                                    <li class="feature-item">
                                        <i class="fas fa-check feature-icon"></i>
                                        <span>Comprehensive Cybersecurity Suite</span>
                                    </li>
                                    <li class="feature-item">
                                        <i class="fas fa-check feature-icon"></i>
                                        <span>Disaster Recovery Planning & Testing</span>
                                    </li>
                                    <li class="feature-item">
                                        <i class="fas fa-check feature-icon"></i>
                                        <span>Onsite Support (as needed)</span>
                                    </li>
                                {% else %}
                                    <!-- Default features for other plans -->
                                    <li class="feature-item">
                                        <i class="fas fa-check feature-icon"></i>
                                        <span>
                                            {% if plan.max_employees == -1 %}
                                                Unlimited employees
                                            {% else %}
                                                Up to {{ plan.max_employees }} employees
                                            {% endif %}
                                        </span>
                                    </li>
                                    <li class="feature-item">
                                        <i class="fas fa-check feature-icon"></i>
                                        <span>
                                            {% if plan.max_customers == -1 %}
                                                Unlimited customers
                                            {% else %}
                                                Up to {{ plan.max_customers }} customers
                                            {% endif %}
                                        </span>
                                    </li>
                                    <li class="feature-item">
                                        <i class="fas fa-check feature-icon"></i>
                                        <span>Customer management</span>
                                    </li>
                                    <li class="feature-item">
                                        <i class="fas fa-check feature-icon"></i>
                                        <span>Service tracking</span>
                                    </li>
                                {% endif %}
                            </ul>
                        </div>
                        
                        <!-- Select Button -->
                        <a href="{% url 'subscriptions:subscribe' plan.slug %}" 
                           class="select-button {% if plan.is_popular %}btn-success{% else %}btn-primary{% endif %}">
                            Order Now
                        </a>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        
        <!-- Footer Info -->
        <div class="footer-info">
            <div class="security-badge">
                <i class="fas fa-shield-alt me-2"></i>
                Secure • No setup fees • Cancel anytime
            </div>
            <div class="terms-links">
                By continuing, you agree to our 
                <a href="{% url 'serve_legal_document' 'terms-of-service' %}" target="_blank">Terms of Service</a> and 
                <a href="{% url 'serve_legal_document' 'privacy-policy' %}" target="_blank">Privacy Policy</a>
            </div>
        </div>
    </div>
</div>
{% endblock public_content %}
