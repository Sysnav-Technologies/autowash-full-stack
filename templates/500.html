<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AutoWash - Service Temporarily Unavailable</title>
    {% load static %}
    <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet">
    <link href="{% static 'css/fontawesome.min.css' %}" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .error-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .error-card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            padding: 3rem;
            max-width: 600px;
            margin: 2rem;
            text-align: center;
        }
        .error-icon {
            font-size: 4rem;
            color: #667eea;
            margin-bottom: 1rem;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            will-change: transform;
        }
        .error-title {
            color: #333;
            font-size: 2rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }
        .error-message {
            color: #666;
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 2rem;
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            padding: 12px 30px;
            font-size: 1.1rem;
            border-radius: 50px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .btn-primary:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.4);
        }
        .support-info {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 1.5rem;
            margin-top: 2rem;
            text-align: left;
        }
        .support-item {
            margin-bottom: 0.5rem;
            color: #555;
        }
        .loading-animation {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin-left: 10px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            background: #28a745;
            border-radius: 50%;
            animation: pulse 1.5s infinite;
            margin-right: 8px;
        }
        @keyframes pulse {
            0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.7); }
            70% { transform: scale(1); box-shadow: 0 0 0 10px rgba(40, 167, 69, 0); }
            100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(40, 167, 69, 0); }
        }
        .auto-refresh {
            color: #28a745;
            font-size: 0.9rem;
            margin-top: 1rem;
        }
    </style>
</head>
<body>
    <div class="error-container">
        <div class="error-card">
            <div class="error-icon">
                <i class="fas fa-car-wash"></i>
            </div>
            <h1 class="error-title">AutoWash is Currently Offline</h1>
            <p class="error-message">
                We're performing routine maintenance to improve your car wash management experience. 
                Our team is working to restore service as quickly as possible.
            </p>
            
            <div class="mb-4">
                <button class="btn btn-primary" onclick="window.location.reload()">
                    <i class="fas fa-sync-alt"></i> Try Again
                </button>
            </div>

            <div class="auto-refresh">
                <span class="status-indicator"></span>
                Page will refresh automatically in a moment
                <span class="loading-animation"></span>
            </div>

            <div class="support-info">
                <h5><i class="fas fa-heart"></i> We're Here to Help</h5>
                <div class="support-item">
                    <i class="fas fa-coffee"></i> Our team is working hard to restore service
                </div>
                <div class="support-item">
                    <i class="fas fa-clock"></i> This usually takes just a few minutes
                </div>
                <div class="support-item">
                    <i class="fas fa-smile"></i> Thank you for your patience
                </div>
                <div class="mt-2 text-muted">
                    <small>
                        <i class="fas fa-shield-alt"></i>
                        Your data and business operations remain safe and secure.
                    </small>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Adaptive auto-refresh with GitHub-style exponential backoff
        let refreshInterval = 15000; // Start with 15 seconds
        let attemptCount = 0;
        let maxAttempts = 10;
        
        function checkServerStatus() {
            if (attemptCount >= maxAttempts) {
                updateStatusMessage('Stopped checking. Please refresh manually.');
                return;
            }
            
            attemptCount++;
            const startTime = Date.now();
            
            // Use a lightweight endpoint to check server status
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), 5000);
            
            fetch(window.location.href, { 
                method: 'HEAD',
                cache: 'no-cache',
                signal: controller.signal
            }).then(response => {
                clearTimeout(timeoutId);
                const responseTime = Date.now() - startTime;
                
                if (response.ok) {
                    // Server is back, reload the page
                    updateStatusMessage('Server restored! Reloading...');
                    setTimeout(() => window.location.reload(), 1000);
                } else {
                    // GitHub-style exponential backoff
                    refreshInterval = Math.min(60000, refreshInterval * 1.2);
                    scheduleNextCheck();
                }
            }).catch(() => {
                clearTimeout(timeoutId);
                // Exponential backoff on error
                refreshInterval = Math.min(45000, refreshInterval * 1.1);
                scheduleNextCheck();
            });
        }
        
        function scheduleNextCheck() {
            setTimeout(checkServerStatus, refreshInterval);
            updateStatusMessage();
        }
        
        function updateStatusMessage(customMessage) {
            const statusText = document.querySelector('.auto-refresh');
            if (statusText) {
                if (customMessage) {
                    statusText.innerHTML = `<span class="status-indicator"></span>${customMessage}`;
                } else {
                    const seconds = Math.round(refreshInterval / 1000);
                    statusText.innerHTML = `
                        <span class="status-indicator"></span>
                        Checking again in ${seconds} seconds (attempt ${attemptCount}/${maxAttempts})
                        <span class="loading-animation"></span>
                    `;
                }
            }
        }
        
        // Start checking when page loads
        setTimeout(() => {
            checkServerStatus();
            updateStatusMessage();
        }, 3000);

        // Add smooth animations
        document.addEventListener('DOMContentLoaded', function() {
            // Smooth icon animation with requestAnimationFrame
            let iconScale = 1;
            let animationId;
            
            function animateIcon() {
                const icon = document.querySelector('.error-icon i');
                if (icon) {
                    iconScale = iconScale === 1 ? 1.03 : 1;
                    icon.style.transform = `scale(${iconScale})`;
                    icon.style.transition = 'transform 0.6s cubic-bezier(0.4, 0, 0.2, 1)';
                }
                
                animationId = setTimeout(animateIcon, 3000);
            }
            
            animateIcon();
            
            // Cleanup on page unload
            window.addEventListener('beforeunload', () => {
                if (animationId) clearTimeout(animationId);
            });
        });
    </script>
</body>
</html>