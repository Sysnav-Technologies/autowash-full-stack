{% extends 'base/base.html' %}
{% load static %}

{% block title %}Payment Receipt - {{ block.super }}{% endblock %}

{% block extra_css %}
<style>
    /* Screen display styles */
    .receipt-container {
        max-width: 400px;
        margin: 0 auto;
        background: white;
        box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        border-radius: 10px;
        overflow: hidden;
    }
    
    .receipt-actions {
        padding: 1rem;
        background: #f8f9fa;
        text-align: center;
        border-bottom: 1px solid #e9ecef;
    }
    
    /* Print styles for 80mm thermal printer */
    @media print {
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.2;
            color: #000;
            background: white;
        }
        
        .receipt-container {
            width: 80mm;
            max-width: 80mm;
            margin: 0;
            padding: 0;
            box-shadow: none;
            border-radius: 0;
        }
        
        .receipt-actions {
            display: none !important;
        }
        
        .no-print {
            display: none !important;
        }
        
        .receipt-content {
            width: 100%;
            padding: 0;
            margin: 0;
        }
        
        .header-section {
            text-align: center;
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px dashed #000;
        }
        
        .business-name {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 2px;
        }
        
        .business-details {
            font-size: 10px;
            margin-bottom: 1px;
        }
        
        .receipt-title {
            font-size: 14px;
            font-weight: bold;
            margin: 8px 0 4px 0;
            text-align: center;
        }
        
        .info-section {
            margin: 6px 0;
            font-size: 11px;
        }
        
        .info-row {
            margin-bottom: 2px;
            width: 100%;
            overflow: hidden;
            clear: both;
        }
        
        .info-label {
            width: 45%;
            text-align: left;
            float: left;
            font-size: 10px;
        }
        
        .info-value {
            width: 54%;
            text-align: right;
            font-weight: bold;
            float: right;
            font-size: 10px;
            word-wrap: break-word;
        }
        
        .service-item {
            margin: 2px 0;
            font-size: 10px;
            clear: both;
        }
        
        .service-name {
            font-weight: bold;
            margin-bottom: 1px;
        }
        
        .service-details {
            display: block;
            margin-bottom: 1px;
        }
        
        .service-section-title {
            font-weight: bold;
            font-size: 11px;
        }
        
        .service-description {
            font-size: 9px;
            margin-top: 1px;
        }
        
        .service-qty {
            float: left;
        }
        
        .service-price {
            float: right;
        }
        
        .clear-float {
            clear: both;
        }
        
        .separator {
            border-bottom: 1px dashed #000;
            margin: 6px 0;
            height: 1px;
        }
        
        .double-separator {
            border-bottom: 2px solid #000;
            margin: 6px 0;
            height: 2px;
        }
        
        .amount-section {
            margin: 8px 0;
        }
        
        .amount-large {
            font-size: 16px;
            font-weight: bold;
            text-align: center;
            margin: 4px 0;
        }
        
        .footer-section {
            margin-top: 8px;
            text-align: center;
            font-size: 10px;
        }
        
        .qr-code {
            text-align: center;
            margin: 8px 0;
        }
        
        .thank-you {
            font-size: 12px;
            font-weight: bold;
            text-align: center;
            margin: 8px 0;
        }
        
        /* Ensure proper spacing for thermal printer */
        .thermal-spacing {
            margin-bottom: 2px;
        }
        
        .center-text {
            text-align: center;
        }
        
        .left-text {
            text-align: left;
        }
        
        .right-text {
            text-align: right;
        }
        
        .cut-line {
            margin-top: 20px;
            text-align: center;
            font-size: 10px;
        }
    }
    
    /* Screen preview styles */
    .receipt-preview {
        font-family: 'Courier New', monospace;
        background: white;
        padding: 20px;
        line-height: 1.3;
    }
    
    .preview-header {
        text-align: center;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 2px dashed #ccc;
    }
    
    .preview-business-name {
        font-size: 18px;
        font-weight: bold;
        margin-bottom: 5px;
    }
    
    .preview-business-details {
        font-size: 12px;
        color: #666;
        margin-bottom: 2px;
    }
    
    .preview-title {
        font-size: 16px;
        font-weight: bold;
        text-align: center;
        margin: 15px 0 10px 0;
    }
    
    .preview-info {
        margin: 10px 0;
    }
    
    .preview-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 3px;
        align-items: flex-start;
        word-wrap: break-word;
    }
    
    .preview-row span:first-child {
        flex: 1;
        margin-right: 10px;
    }
    
    .preview-row span:last-child {
        flex-shrink: 0;
        text-align: right;
    }
    
    .preview-separator {
        border-bottom: 1px dashed #ccc;
        margin: 10px 0;
    }
    
    .preview-amount {
        font-size: 20px;
        font-weight: bold;
        text-align: center;
        margin: 15px 0;
        color: #28a745;
    }
    
    .preview-footer {
        text-align: center;
        margin-top: 15px;
        font-size: 12px;
        color: #666;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid px-4">
    <div class="receipt-container">
        <!-- Action Buttons (hidden in print) -->
        <div class="receipt-actions no-print">
            <h4 class="mb-3">Payment Receipt</h4>
            <button class="btn btn-primary me-2" onclick="printReceipt()">
                <i class="fas fa-print me-2"></i>Print Receipt
            </button>
            <button class="btn btn-outline-secondary me-2" onclick="downloadPDF()">
                <i class="fas fa-download me-2"></i>Download PDF
            </button>
            <a href="/business/{{ request.tenant.slug }}/payments/" class="btn btn-outline-dark">
                <i class="fas fa-arrow-left me-2"></i>Back
            </a>
        </div>
        
        <!-- Receipt Content -->
        <div class="receipt-content">
            <!-- For Print -->
            <div class="d-print-block d-none">
                <!-- Header Section -->
                <div class="header-section">
                    <div class="business-name">{{ request.tenant.name|upper }}</div>
                    {% if request.tenant.address %}
                    <div class="business-details">{{ request.tenant.address }}</div>
                    {% endif %}
                    {% if request.tenant.phone %}
                    <div class="business-details">Tel: {{ request.tenant.phone }}</div>
                    {% endif %}
                    {% if request.tenant.email %}
                    <div class="business-details">{{ request.tenant.email }}</div>
                    {% endif %}
                    {% if request.tenant.website %}
                    <div class="business-details">{{ request.tenant.website }}</div>
                    {% endif %}
                </div>
                
                <div class="receipt-title">PAYMENT RECEIPT</div>
                
                <!-- Payment Information -->
                <div class="info-section">
                    <div class="info-row">
                        <span class="info-label">Receipt No:</span>
                        <span class="info-value">{{ payment.payment_id }}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Date:</span>
                        <span class="info-value">{{ payment.created_at|date:"d/m/Y" }}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Time:</span>
                        <span class="info-value">{{ payment.created_at|date:"H:i" }}</span>
                    </div>
                    {% if payment.processed_by %}
                    <div class="info-row">
                        <span class="info-label">Cashier:</span>
                        <span class="info-value">{{ payment.processed_by.user.first_name }}</span>
                    </div>
                    {% endif %}
                </div>
                
                <div class="separator"></div>
                
                <!-- Customer Information -->
                {% if payment.customer %}
                <div class="info-section">
                    <div class="info-row">
                        <span class="info-label">Customer:</span>
                        <span class="info-value">{{ payment.customer.display_name }}</span>
                    </div>
                    {% if payment.customer.phone %}
                    <div class="info-row">
                        <span class="info-label">Phone:</span>
                        <span class="info-value">{{ payment.customer.phone }}</span>
                    </div>
                    {% endif %}
                    {% if payment.customer.customer_id %}
                    <div class="info-row">
                        <span class="info-label">Customer ID:</span>
                        <span class="info-value">{{ payment.customer.customer_id }}</span>
                    </div>
                    {% endif %}
                </div>
                <div class="separator"></div>
                {% endif %}
                
                <!-- Service Order Information -->
                {% if payment.service_order %}
                <div class="info-section">
                    <div class="info-row">
                        <span class="info-label">Order No:</span>
                        <span class="info-value">{{ payment.service_order.order_number }}</span>
                    </div>
                    {% if payment.service_order.service_date %}
                    <div class="info-row">
                        <span class="info-label">Service Date:</span>
                        <span class="info-value">{{ payment.service_order.service_date|date:"d/m/Y" }}</span>
                    </div>
                    {% endif %}
                    {% if payment.service_order.vehicle %}
                    <div class="info-row">
                        <span class="info-label">Vehicle:</span>
                        <span class="info-value">{{ payment.service_order.vehicle.license_plate }}</span>
                    </div>
                    {% endif %}
                </div>
                <div class="separator"></div>
                
                <!-- Service Order Items -->
                {% if payment.service_order.has_services %}
                <div class="info-section">
                    <div class="center-text thermal-spacing service-section-title">
                        SERVICES PROVIDED
                    </div>
                    {% for item in payment.service_order.service_items %}
                    <div class="service-item">
                        <div class="service-name">{{ item.item_name }}</div>
                        <div class="service-details">
                            <span class="service-qty">Qty: {{ item.quantity }}</span>
                            <span class="service-price">KES {{ item.total_price|floatformat:2 }}</span>
                            <div class="clear-float"></div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                <div class="separator"></div>
                {% endif %}
                
                {% if payment.service_order.has_inventory_items %}
                <div class="info-section">
                    <div class="center-text thermal-spacing service-section-title">
                        ITEMS PROVIDED
                    </div>
                    {% for item in payment.service_order.inventory_items %}
                    <div class="service-item">
                        <div class="service-name">{{ item.item_name }}
                            {% if item.inventory_item.sku %}
                                <small>({{ item.inventory_item.sku }})</small>
                            {% endif %}
                        </div>
                        <div class="service-details">
                            <span class="service-qty">Qty: {{ item.quantity }}</span>
                            <span class="service-price">KES {{ item.total_price|floatformat:2 }}</span>
                            <div class="clear-float"></div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                <div class="separator"></div>
                {% endif %}
                
                <!-- Fallback for legacy orders -->
                {% if not payment.service_order.has_services and not payment.service_order.has_inventory_items %}
                <div class="info-section">
                    <div class="center-text thermal-spacing service-section-title">
                        ITEMS PROVIDED
                    </div>
                    {% if payment.service_order.services.all %}
                        {% for service in payment.service_order.services.all %}
                        <div class="service-item">
                            <div class="service-name">[SERVICE] {{ service.name }}</div>
                            <div class="service-details">
                                <span class="service-qty">Qty: 1</span>
                                <span class="service-price">KES {{ service.price|floatformat:2 }}</span>
                                <div class="clear-float"></div>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="service-item">
                            <div class="service-name">
                                {% if payment.service_order.service_type %}
                                    {{ payment.service_order.service_type }}
                                {% else %}
                                    Service Order #{{ payment.service_order.order_number }}
                                {% endif %}
                            </div>
                            <div class="service-details">
                                <span class="service-price">KES {{ payment.amount|floatformat:2 }}</span>
                                <div class="clear-float"></div>
                            </div>
                        </div>
                    {% endif %}
                </div>
                <div class="separator"></div>
                {% endif %}
                {% else %}
                <!-- Direct Payment (No Service Order) -->
                <div class="info-section">
                    <div class="center-text thermal-spacing service-section-title">
                        PAYMENT DETAILS
                    </div>
                    <div class="service-item">
                        <div class="service-name">
                            {% if payment.description %}
                                {{ payment.description }}
                            {% else %}
                                General Payment
                            {% endif %}
                        </div>
                        <div class="service-details">
                            <span class="service-price">KES {{ payment.amount|floatformat:2 }}</span>
                            <div class="clear-float"></div>
                        </div>
                    </div>
                </div>
                <div class="separator"></div>
                {% endif %}
                
                <!-- Payment Details -->
                <div class="info-section">
                    <div class="info-row">
                        <span class="info-label">Payment Type:</span>
                        <span class="info-value">{{ payment.get_payment_type_display }}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Method:</span>
                        <span class="info-value">{{ payment.payment_method.name }}</span>
                    </div>
                    {% if payment.transaction_id %}
                    <div class="info-row">
                        <span class="info-label">Trans ID:</span>
                        <span class="info-value">{{ payment.transaction_id|truncatechars:15 }}</span>
                    </div>
                    {% endif %}
                </div>
                
                <div class="separator"></div>
                
                <!-- Amount Section -->
                <div class="amount-section">
                    {% if payment.service_order %}
                    <!-- Service Order Payment Breakdown -->
                    <div class="info-row">
                        <span class="info-label">Subtotal (ex VAT):</span>
                        <span class="info-value">KES {{ payment.service_order.subtotal|floatformat:2 }}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">VAT (16%):</span>
                        <span class="info-value">KES {{ payment.service_order.tax_amount|floatformat:2 }}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Total Order:</span>
                        <span class="info-value">KES {{ payment.service_order.total_amount|floatformat:2 }}</span>
                    </div>
                    
                    <!-- Payment Details -->
                    <div class="separator"></div>
                    <div class="info-row">
                        <span class="info-label">Payment Amount:</span>
                        <span class="info-value">KES {{ payment.amount|floatformat:2 }}</span>
                    </div>
                    {% if payment.processing_fee > 0 %}
                    <div class="info-row">
                        <span class="info-label">Processing Fee:</span>
                        <span class="info-value">KES {{ payment.processing_fee|floatformat:2 }}</span>
                    </div>
                    {% endif %}
                    
                    <!-- Show partial payment info if applicable -->
                    {% with payment.service_order.total_paid as total_paid %}
                    {% if total_paid < payment.service_order.total_amount %}
                    <div class="info-row">
                        <span class="info-label">Total Paid:</span>
                        <span class="info-value">KES {{ total_paid|floatformat:2 }}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Balance Due:</span>
                        <span class="info-value">KES {{ payment.service_order.total_amount|floatformat:2|add:"-"|add:total_paid|floatformat:2 }}</span>
                    </div>
                    {% endif %}
                    {% endwith %}
                    {% else %}
                    <!-- Direct Payment -->
                    <div class="info-row">
                        <span class="info-label">Amount:</span>
                        <span class="info-value">KES {{ payment.amount|floatformat:2 }}</span>
                    </div>
                    {% if payment.processing_fee > 0 %}
                    <div class="info-row">
                        <span class="info-label">Processing Fee:</span>
                        <span class="info-value">KES {{ payment.processing_fee|floatformat:2 }}</span>
                    </div>
                    {% endif %}
                    {% endif %}
                </div>
                
                <div class="double-separator"></div>
                
                <div class="amount-large">
                    TOTAL: KES {{ payment.amount|add:payment.processing_fee|floatformat:2 }}
                </div>
                
                <div class="double-separator"></div>
                
                <!-- Payment Status -->
                <div class="center-text thermal-spacing">
                    STATUS: {{ payment.get_status_display|upper }}
                </div>
                
                {% if payment.description %}
                <div class="separator"></div>
                <div class="center-text thermal-spacing">
                    {{ payment.description|truncatechars:40 }}
                </div>
                {% endif %}
                
                <div class="separator"></div>
                
                <!-- Footer -->
                <div class="footer-section">
                    <div class="thermal-spacing">Thank you for your business!</div>
                    <div class="thermal-spacing">Visit us again soon</div>
                    <div class="thermal-spacing">{{ request.tenant.website|default:"www.autowash.co.ke" }}</div>
                    <div class="thermal-spacing">Powered by AutoWash</div>
                </div>
                
                <!-- Cut line indicator for thermal printer -->
                <div class="cut-line">
                    ........................................
                </div>
            </div>
            
            <!-- For Screen Preview -->
            <div class="receipt-preview d-print-none">
                <!-- Header -->
                <div class="preview-header">
                    <div class="preview-business-name">{{ request.tenant.name|upper }}</div>
                    {% if request.tenant.address %}
                    <div class="preview-business-details">{{ request.tenant.address }}</div>
                    {% endif %}
                    {% if request.tenant.phone %}
                    <div class="preview-business-details">Tel: {{ request.tenant.phone }}</div>
                    {% endif %}
                    {% if request.tenant.email %}
                    <div class="preview-business-details">{{ request.tenant.email }}</div>
                    {% endif %}
                </div>
                
                <div class="preview-title">PAYMENT RECEIPT</div>
                
                <!-- Receipt Information -->
                <div class="preview-info">
                    <div class="preview-row">
                        <span>Receipt No:</span>
                        <strong>{{ payment.payment_id }}</strong>
                    </div>
                    <div class="preview-row">
                        <span>Date & Time:</span>
                        <strong>{{ payment.created_at|date:"M d, Y H:i" }}</strong>
                    </div>
                    {% if payment.processed_by %}
                    <div class="preview-row">
                        <span>Processed by:</span>
                        <strong>{{ payment.processed_by.user.get_full_name }}</strong>
                    </div>
                    {% endif %}
                </div>
                
                <div class="preview-separator"></div>
                
                <!-- Customer Information -->
                {% if payment.customer %}
                <div class="preview-info">
                    <div class="preview-row">
                        <span>Customer:</span>
                        <strong>{{ payment.customer.display_name }}</strong>
                    </div>
                    {% if payment.customer.phone %}
                    <div class="preview-row">
                        <span>Phone:</span>
                        <strong>{{ payment.customer.phone }}</strong>
                    </div>
                    {% endif %}
                </div>
                <div class="preview-separator"></div>
                {% endif %}
                
                <!-- Service Order -->
                {% if payment.service_order %}
                <div class="preview-info">
                    <div class="preview-row">
                        <span>Service Order:</span>
                        <strong>{{ payment.service_order.order_number }}</strong>
                    </div>
                    {% if payment.service_order.vehicle %}
                    <div class="preview-row">
                        <span>Vehicle:</span>
                        <strong>{{ payment.service_order.vehicle.license_plate }}</strong>
                    </div>
                    {% endif %}
                </div>
                <div class="preview-separator"></div>
                
                <!-- Service Items -->
                {% if payment.service_order.has_services %}
                <div class="preview-info">
                    <h6 class="text-center mb-2"><i class="fas fa-tools me-2"></i>Services Provided</h6>
                    {% for item in payment.service_order.service_items %}
                    <div class="mb-2">
                        <div class="preview-row">
                            <span><strong>{{ item.item_name }}</strong></span>
                            <strong>KES {{ item.total_price|floatformat:2 }}</strong>
                        </div>
                        <div class="preview-row">
                            <span><small>Qty: {{ item.quantity }}</small></span>
                            <span><small>@ KES {{ item.unit_price|floatformat:2 }}</small></span>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                <div class="preview-separator"></div>
                {% endif %}
                
                {% if payment.service_order.has_inventory_items %}
                <div class="preview-info">
                    <h6 class="text-center mb-2"><i class="fas fa-box me-2"></i>Items Provided</h6>
                    {% for item in payment.service_order.inventory_items %}
                    <div class="mb-2">
                        <div class="preview-row">
                            <span><strong>{{ item.item_name }}
                                {% if item.inventory_item.sku %}
                                    <small>({{ item.inventory_item.sku }})</small>
                                {% endif %}
                            </strong></span>
                            <strong>KES {{ item.total_price|floatformat:2 }}</strong>
                        </div>
                        <div class="preview-row">
                            <span><small>Qty: {{ item.quantity }}</small></span>
                            <span><small>@ KES {{ item.unit_price|floatformat:2 }}</small></span>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                <div class="preview-separator"></div>
                {% endif %}
                
                <!-- Fallback for legacy orders -->
                {% if not payment.service_order.has_services and not payment.service_order.has_inventory_items %}
                <div class="preview-info">
                    <h6 class="text-center mb-2">Items Provided</h6>
                    {% if payment.service_order.services.all %}
                        {% for service in payment.service_order.services.all %}
                        <div class="mb-2">
                            <div class="preview-row">
                                <span><strong>[SERVICE] {{ service.name }}</strong></span>
                                <strong>KES {{ service.price|floatformat:2 }}</strong>
                            </div>
                            <div class="preview-row">
                                <span><small>Qty: 1</small></span>
                                <span><small>@ KES {{ service.price|floatformat:2 }}</small></span>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="preview-row">
                            <span><strong>
                                {% if payment.service_order.service_type %}
                                    {{ payment.service_order.service_type }}
                                {% else %}
                                    Service Order #{{ payment.service_order.order_number }}
                                {% endif %}
                            </strong></span>
                            <strong>KES {{ payment.amount|floatformat:2 }}</strong>
                        </div>
                    {% endif %}
                </div>
                <div class="preview-separator"></div>
                {% endif %}
                {% endif %}
                
                <!-- Payment Details -->
                <div class="preview-info">
                    <div class="preview-row">
                        <span>Payment Method:</span>
                        <strong>{{ payment.payment_method.name }}</strong>
                    </div>
                    <div class="preview-row">
                        <span>Payment Type:</span>
                        <strong>{{ payment.get_payment_type_display }}</strong>
                    </div>
                    {% if payment.transaction_id %}
                    <div class="preview-row">
                        <span>Transaction ID:</span>
                        <strong>{{ payment.transaction_id }}</strong>
                    </div>
                    {% endif %}
                    
                    {% if payment.service_order %}
                    <!-- Service Order Payment Breakdown -->
                    <div class="preview-row">
                        <span>Subtotal (ex VAT):</span>
                        <strong>KES {{ payment.service_order.subtotal|floatformat:2 }}</strong>
                    </div>
                    <div class="preview-row">
                        <span>VAT (16%):</span>
                        <strong>KES {{ payment.service_order.tax_amount|floatformat:2 }}</strong>
                    </div>
                    <div class="preview-row">
                        <span>Total Order:</span>
                        <strong>KES {{ payment.service_order.total_amount|floatformat:2 }}</strong>
                    </div>
                    <div class="preview-row">
                        <span>Payment Amount:</span>
                        <strong>KES {{ payment.amount|floatformat:2 }}</strong>
                    </div>
                    
                    <!-- Show partial payment info if applicable -->
                    {% with payment.service_order.total_paid as total_paid %}
                    {% if total_paid < payment.service_order.total_amount %}
                    <div class="preview-row">
                        <span>Total Paid:</span>
                        <strong>KES {{ total_paid|floatformat:2 }}</strong>
                    </div>
                    <div class="preview-row">
                        <span>Balance Due:</span>
                        <strong>KES {{ payment.service_order.total_amount|floatformat:2|add:"-"|add:total_paid|floatformat:2 }}</strong>
                    </div>
                    {% endif %}
                    {% endwith %}
                    {% else %}
                    <!-- Direct Payment -->
                    <div class="preview-row">
                        <span>Amount:</span>
                        <strong>KES {{ payment.amount|floatformat:2 }}</strong>
                    </div>
                    {% endif %}
                    
                    {% if payment.processing_fee > 0 %}
                    <div class="preview-row">
                        <span>Processing Fee:</span>
                        <strong>KES {{ payment.processing_fee|floatformat:2 }}</strong>
                    </div>
                    {% endif %}
                </div>
                
                <div class="preview-separator"></div>
                
                <div class="preview-amount">
                    TOTAL: KES {{ payment.amount|add:payment.processing_fee|floatformat:2 }}
                </div>
                
                <div class="preview-separator"></div>
                
                <div class="text-center">
                    <span class="badge bg-success fs-6">{{ payment.get_status_display }}</span>
                </div>
                
                {% if payment.description %}
                <div class="preview-separator"></div>
                <div class="text-center">
                    <em>{{ payment.description }}</em>
                </div>
                {% endif %}
                
                <div class="preview-footer">
                    <p class="mb-1"><strong>Thank you for your business!</strong></p>
                    <p class="mb-1">{{ request.tenant.website|default:"www.autowash.co.ke" }}</p>
                    <p class="mb-0"><small>Powered by AutoWash</small></p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function printReceipt() {
    // Add print-specific styles for thermal printer
    const printCSS = `
        <style>
            @page {
                size: 80mm auto;
                margin: 0;
            }
            
            @media print {
                body {
                    width: 80mm;
                    margin: 0;
                    padding: 0;
                    font-family: 'Courier New', monospace;
                    font-size: 12px;
                    line-height: 1.2;
                }
            }
        </style>
    `;
    
    // Add CSS to head temporarily
    const style = document.createElement('style');
    style.innerHTML = printCSS;
    document.head.appendChild(style);
    
    // Print
    window.print();
    
    // Remove the temporary style after printing
    setTimeout(() => {
        document.head.removeChild(style);
    }, 1000);
}

function downloadPDF() {
    // This would integrate with a PDF generation service
    // For now, we'll use the browser's print to PDF functionality
    const printButton = document.querySelector('.receipt-actions');
    printButton.style.display = 'none';
    
    window.print();
    
    setTimeout(() => {
        printButton.style.display = 'block';
    }, 1000);
}

// Auto-print if print parameter is present
const urlParams = new URLSearchParams(window.location.search);
if (urlParams.get('print') === '1') {
    setTimeout(printReceipt, 500);
}
</script>
{% endblock %}
